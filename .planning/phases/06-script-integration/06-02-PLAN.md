---
phase: 06-script-integration
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - utilities/src/main/java/utilities/loadout/LoadoutManager.java
autonomous: true
---

<objective>
Create LoadoutManager facade for script-level loadout integration.

Purpose: Provide a simple, unified API that scripts use to manage loadouts - editing, persistence, and restocking.
Output: LoadoutManager class that ties together editor, persistence, and restocker.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase work
@.planning/phases/06-script-integration/06-01-PLAN.md

# Existing components to integrate
@utilities/src/main/java/utilities/loadout/Loadout.java
@utilities/src/main/java/utilities/loadout/LoadoutRestocker.java
@utilities/src/main/java/utilities/loadout/ui/LoadoutEditor.java

# ScriptUI integration pattern reference
@TidalsLoadoutTester/src/main/java/main/ScriptUI.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LoadoutManager facade</name>
  <files>utilities/src/main/java/utilities/loadout/LoadoutManager.java</files>
  <action>
Create LoadoutManager as the main entry point for scripts to use loadouts.

Constructor:
- `LoadoutManager(Script script, String scriptName)` - creates manager bound to script instance

Methods:
- `getLoadout()` - returns the current loadout (never null, creates empty if needed)
- `setLoadout(Loadout loadout)` - sets the current loadout
- `showEditor()` - opens LoadoutEditor popup, returns true if saved
- `saveToPreferences()` - saves current loadout as script's default
- `loadFromPreferences()` - loads script's default loadout (returns false if none)
- `restock()` - restocks current loadout from bank, returns RestockResult

Internal state:
- Hold current Loadout instance
- Create ItemResolver on first use (lazy init)
- Create LoadoutRestocker on first use (lazy init)

This facade pattern keeps scripts simple:
```java
// in ScriptUI or setup
LoadoutManager loadouts = new LoadoutManager(script, "MyScript");
loadouts.loadFromPreferences();  // restore last config
loadouts.showEditor();           // let user edit
loadouts.saveToPreferences();    // remember for next time

// in banking task
RestockResult result = loadouts.restock();
```
  </action>
  <verify>Build utilities jar: `cd tidals-scripts && JAVA_HOME=$(/usr/libexec/java_home -v 17) gradle :utilities:build`</verify>
  <done>LoadoutManager compiles with getLoadout, setLoadout, showEditor, save/load persistence, and restock methods</done>
</task>

<task type="auto">
  <name>Task 2: Add helper methods for common patterns</name>
  <files>utilities/src/main/java/utilities/loadout/LoadoutManager.java</files>
  <action>
Add convenience methods for common script patterns:

- `hasLoadout()` - returns true if loadout has any items defined
- `needsRestock()` - compares current state to loadout, returns true if anything missing
- `createRestockButton(String label)` - returns a JavaFX Button that calls restock when clicked

Also add:
- `getRestocker()` - exposes the LoadoutRestocker for advanced use cases
- `getItemResolver()` - exposes ItemResolver for scripts that need it

These helpers reduce boilerplate in scripts and provide a clean integration story.
  </action>
  <verify>Build utilities jar: `cd tidals-scripts && JAVA_HOME=$(/usr/libexec/java_home -v 17) gradle :utilities:build`</verify>
  <done>LoadoutManager has hasLoadout, needsRestock, createRestockButton helper methods</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `gradle :utilities:build` succeeds without errors
- [ ] LoadoutManager provides clean facade over editor, persistence, restocker
- [ ] Scripts can use loadouts with minimal boilerplate code
- [ ] Lazy initialization prevents unnecessary object creation
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- LoadoutManager provides complete script-facing API
</success_criteria>

<output>
After completion, create `.planning/phases/06-script-integration/06-02-SUMMARY.md`
</output>
