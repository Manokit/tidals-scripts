---
phase: 02-item-resolution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [utilities/src/main/java/utilities/items/ItemVariantMap.java]
autonomous: true
---

<objective>
Create ItemVariantMap class with static mappings for degradable item variants.

Purpose: Enable fuzzy matching on Barrows/Crystal items where each charge state has a unique ID. The loadout's fuzzy flag uses this to match any variant of the same base item.
Output: ItemVariantMap.java with getBaseId(), getAllVariants(), getPreferredVariant() methods.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-item-resolution/02-RESEARCH.md

# Phase 1 data model (provides LoadoutItem with fuzzy flag)
@utilities/src/main/java/utilities/loadout/LoadoutItem.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ItemVariantMap with Barrows mappings</name>
  <files>utilities/src/main/java/utilities/items/ItemVariantMap.java</files>
  <action>
Create new package `utilities.items` and ItemVariantMap class with:
- Static Map<Integer, Integer> VARIANT_TO_BASE (any variant ID -> base ID)
- Static Map<Integer, int[]> BASE_TO_VARIANTS (base ID -> all variants, ordered highest charge first)
- Static initializer registering all Barrows items:
  - Dharok's: platebody (4720, 4880, 4881, 4882, 4883, 4884), helm (4716, 4856, 4857, 4858, 4859, 4860), axe (4718, 4862, 4863, 4864, 4865, 4866), platelegs (4722, 4886, 4887, 4888, 4889, 4890)
  - Ahrim's: robetop (4712, 4856...), hood, staff, robeskirt
  - Karil's: coif, leathertop, crossbow, leatherskirt
  - Torag's: helm, platebody, hammers, platelegs
  - Guthan's: helm, platebody, warspear, chainskirt
  - Verac's: helm, brassard, flail, plateskirt
- Use RuneLite ItemID constants where available, otherwise hardcode verified IDs
- Private static registerVariants(int baseId, int... variants) helper
  </action>
  <verify>javac compiles without errors</verify>
  <done>ItemVariantMap class exists with all Barrows item mappings</done>
</task>

<task type="auto">
  <name>Task 2: Add Crystal equipment and helper methods</name>
  <files>utilities/src/main/java/utilities/items/ItemVariantMap.java</files>
  <action>
Add to static initializer:
- Crystal bow variants (10 states: new, full, 9/10 through 1/10)
- Crystal shield variants (10 states)
- Crystal halberd variants (10 states)
- Serpentine helm variants (uncharged, charged)
- Toxic blowpipe variants (empty, charged)

Add public static methods:
- getBaseId(int itemId) - returns base ID or itemId if not a variant
- getAllVariants(int itemId) - returns array of all variant IDs for this item's base (highest charge first)
- getPreferredVariant(int itemId) - returns first (highest charge) variant
- isVariant(int itemId) - returns true if this ID is in the variant map
- areVariants(int id1, int id2) - returns true if both map to same base
  </action>
  <verify>javac compiles, areVariants(4720, 4884) returns true (Dharok's platebody variants)</verify>
  <done>ItemVariantMap has Crystal/Serpentine/Blowpipe mappings and all helper methods</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd utilities && JAVA_HOME=$(/usr/libexec/java_home -v 17) gradle build` succeeds
- [ ] ItemVariantMap.getBaseId() returns correct base for known variants
- [ ] ItemVariantMap.areVariants() correctly identifies same-base items
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- ItemVariantMap provides variant matching for Barrows, Crystal, Serpentine, Blowpipe
- Methods are static for easy use without instantiation
</success_criteria>

<output>
After completion, create `.planning/phases/02-item-resolution/02-01-SUMMARY.md`
</output>
