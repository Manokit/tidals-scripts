---
phase: 04-import-export
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - utilities/src/main/java/utilities/loadout/ui/LoadoutEditor.java
autonomous: false
---

<objective>
Add import/export buttons to LoadoutEditor UI.

Purpose: Let users import RuneLite setups and export loadouts from the editor.
Output: Import/Export buttons in LoadoutEditor with file dialogs.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan output (depends on import/export classes):
@.planning/phases/04-import-export/04-01-SUMMARY.md

# UI to modify:
@utilities/src/main/java/utilities/loadout/ui/LoadoutEditor.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Import/Export buttons to LoadoutEditor</name>
  <files>utilities/src/main/java/utilities/loadout/ui/LoadoutEditor.java</files>
  <action>
Add Import and Export buttons to the LoadoutEditor header row.

Layout change - update header to include buttons:
```
+------------------------------------------+
| Loadout Editor    [Import] [Export]      |
+------------------------------------------+
```

Button placement:
- Create HBox with title on left, buttons on right (use Region spacer between)
- Import button: "Import" text, same BUTTON_STYLE as Save/Cancel
- Export button: "Export" text, same BUTTON_STYLE as Save/Cancel
- Add 10px spacing between Import and Export buttons

Import button action (handleImport method):
1. Open JavaFX FileChooser with filter for *.json
2. Read file contents to String
3. Call LoadoutImporter.fromJson(jsonString)
4. Copy imported loadout data into workingCopy:
   - Equipment slots
   - Inventory slots
   - Pouches (if present in import)
5. Refresh all UI grids from workingCopy
6. Show success alert with loadout name
7. On error: show error Alert with message, don't modify loadout

Export button action (handleExport method):
1. First sync workingCopy FROM current UI state (grids may have unsaved changes)
2. Call LoadoutExporter.toJsonPretty(workingCopy)
3. Open JavaFX FileChooser (save dialog) with default name "{loadoutName}.json"
4. Write JSON string to selected file
5. Show success alert
6. On error: show error Alert with message

Import statements to add:
- java.io.File
- java.nio.file.Files
- javafx.stage.FileChooser
- javafx.scene.control.Alert
- utilities.loadout.LoadoutImporter
- utilities.loadout.LoadoutExporter

FileChooser setup:
```java
FileChooser chooser = new FileChooser();
chooser.setTitle("Import RuneLite Loadout");
chooser.getExtensionFilters().add(
    new FileChooser.ExtensionFilter("JSON Files", "*.json")
);
File file = chooser.showOpenDialog(stage);
```

For save dialog use:
```java
chooser.setInitialFileName(workingCopy.getName() + ".json");
File file = chooser.showSaveDialog(stage);
```

Alert setup for success/error:
```java
Alert alert = new Alert(Alert.AlertType.INFORMATION);
alert.setTitle("Import Successful");
alert.setHeaderText(null);
alert.setContentText("Imported loadout: " + loadout.getName());
alert.showAndWait();
```

Note: When importing, only update loadout NAME if original loadout has default/empty name.
Otherwise keep original name to avoid confusion.
</action>
  <verify>Build utilities jar with `gradle :utilities:build`. No compilation errors.</verify>
  <done>LoadoutEditor has Import and Export buttons. Build succeeds.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Import/Export buttons in LoadoutEditor that use file dialogs to load/save JSON</what-built>
  <how-to-verify>
    1. Open TidalsLoadoutTester (or any script with loadout editor)
    2. Open the LoadoutEditor popup
    3. Click "Export" button
       - File save dialog should appear
       - Save to a test location
       - Verify JSON file is created and contains valid JSON
    4. Clear some slots in the editor
    5. Click "Import" button
       - File open dialog should appear
       - Select the JSON file you exported
       - Loadout should be restored with all items
    6. Test importing a RuneLite Inventory Setups export if available
    7. Verify error handling: try importing an invalid file
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Import button opens file chooser, loads JSON, updates UI
- [ ] Export button saves current loadout to JSON file
- [ ] Error handling shows user-friendly messages
- [ ] Buttons follow existing OSRS theme styling
- [ ] Human verification passed
</verification>

<success_criteria>
- Import/Export buttons visible in LoadoutEditor header
- Import successfully loads RuneLite format JSON
- Export produces valid JSON that can be re-imported
- User receives feedback (success/error alerts)
</success_criteria>

<output>
After completion, create `.planning/phases/04-import-export/04-02-SUMMARY.md`
</output>
